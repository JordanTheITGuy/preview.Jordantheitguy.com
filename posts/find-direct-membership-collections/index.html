<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Find Direct Membership Collections - JordanTheITGuy</title><meta name=description content="Direct Membership rules are frequently a topic for debate due to performance and other reasons. This post will show you how to find them!"><meta property="og:title" content="Find Direct Membership Collections"><meta property="og:description" content="Direct Membership rules are frequently a topic for debate due to performance and other reasons. This post will show you how to find them!"><meta property="og:type" content="article"><meta property="og:url" content="http://jordantheitguy.com/posts/find-direct-membership-collections/"><meta property="og:image" content="http://jordantheitguy.com/images/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-17T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-17T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://jordantheitguy.com/images/logo.png"><meta name=twitter:title content="Find Direct Membership Collections"><meta name=twitter:description content="Direct Membership rules are frequently a topic for debate due to performance and other reasons. This post will show you how to find them!"><meta name=application-name content="JordanTheITGuy"><meta name=apple-mobile-web-app-title content="JordanTheITGuy"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://jordantheitguy.com/posts/find-direct-membership-collections/><link rel=prev href=http://jordantheitguy.com/posts/memcm-community-hub-getting-started/><link rel=next href=http://jordantheitguy.com/posts/mr-shiba-what-time-is-it-get-time-remotely/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Find Direct Membership Collections","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/jordantheitguy.com\/posts\/find-direct-membership-collections\/"},"genre":"posts","keywords":"SQL, ConfigMgr","wordcount":464,"url":"http:\/\/jordantheitguy.com\/posts\/find-direct-membership-collections\/","datePublished":"2020-08-17T00:00:00+00:00","dateModified":"2020-08-17T00:00:00+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Jordan Benzing"},"author":{"@type":"Person","name":"Jordan Benzing"},"description":"Direct Membership rules are frequently a topic for debate due to performance and other reasons. This post will show you how to find them!"}</script></head><body header-desktop header-mobile><script type=text/javascript>(''==='true'&&window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=JordanTheITGuy><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/internalLogo.png data-srcset="/images/internalLogo.png, /images/internalLogo.png 1.5x, /images/internalLogo.png 2x" data-sizes=auto alt=/images/internalLogo.png title=/images/internalLogo.png><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/stories/>Stories </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=JordanTheITGuy><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/internalLogo.png data-srcset="/images/internalLogo.png, /images/internalLogo.png 1.5x, /images/internalLogo.png 2x" data-sizes=auto alt=/images/internalLogo.png title=/images/internalLogo.png><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/stories/ title>Stories</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Find Direct Membership Collections</h1><h2 class=single-subtitle>How to find any collection in ConfigMgr with Direct Membership Rules</h2><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author>Jordan Benzing</a></span>&nbsp;<span class=post-category>included in <a href=/categories/configmgr/><i class="far fa-folder fa-fw"></i>ConfigMgr</a>&nbsp;<a href=/categories/sql/><i class="far fa-folder fa-fw"></i>SQL</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-08-17>2020-08-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;464 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;3 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#sql-query>SQL Query</a><ul><li><a href=#rule-names>Rule Names</a></li><li><a href=#resourcetype>ResourceType</a></li></ul></li><li><a href=#stop-talking-give-me-the-query>Stop Talking give me the Query</a></li></ul></nav></div></div><div class=content id=content><p>Direct Membership rules are frequently a topic for debate due to performance, and other challenges. However, if you work in an environment where you share Configuration Manager with several other admins you might not know just how many collections you have with direct memberships, or where they are.</p><h2 id=sql-query>SQL Query</h2><p>SQL, something most configuration admins are uncomfortable with for some reason or another. In this particular case is probably the fastest and most direct method of acquiring the information you want. If all you want is to know what collections have direct membership rules you can start just by selecting:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln>0</span><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>V_CollectionRuleDirect</span><span class=w>
</span></span></span></code></pre></div><p>This will get you all of the direct membership collection rules in an environment.</p><p>A couple things to note here, we are provided the CollectionID, where the rule is attached, the NAME of the rule, the RESOURCEID indicated by the rule, and the resource type. The rule name, and resource type are worth paying special attention to for a few reasons.</p><h3 id=rule-names>Rule Names</h3><p>When a direct membership is created using a DEVICE ‚Äì or resource type 5 more on that later ‚Äì the devices NAME is used as the rule name, and it‚Äôs resourceID is whats used in the queries actual language. This is part of why direct memberships are so contentious. As when a machine is re-imaged it may have a different resource ID, causing the rule to lose all purpose and meaning.</p><h3 id=resourcetype>ResourceType</h3><p>In the example above I have a USER based collection called ‚ÄúApp-Minecraft‚Äù that I am using to deploy Minecraft to users who are a member of a group. It‚Äôs important to note GROUPS show up as direct memberships as well and do NOT suffer the same complications as direct membership device rules.</p><p>If you‚Äôre wondering how I know that resource type 3 is user group, and 5 is system you can use the below query to find out the mapping of ResourceType to its display Name, and its class name view in the database.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln>0</span><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>v_ResourceMap</span><span class=w>
</span></span></span></code></pre></div><h2 id=stop-talking-give-me-the-query>Stop Talking give me the Query</h2><p>With those little bits of information in hand we can easily create a very simple query using the COUNT, GROUP BY, and WHERE to find and sort our collections with direct memberships that are dictated by DEVICES.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln>0</span><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>V_CollectionRuleDirect</span><span class=p>.</span><span class=n>CollectionID</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s1>&#39;CollectionID&#39;</span><span class=w>
</span></span></span><span class=line><span class=ln>1</span><span class=cl><span class=w>	</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=w> </span><span class=p>(</span><span class=n>V_CollectionRuleDirect</span><span class=p>.</span><span class=n>CollectionID</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s1>&#39;TOTAL&#39;</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>v_CollectionRuleDirect</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>v_CollectionRuleDirect</span><span class=p>.</span><span class=n>ResourceType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;5&#39;</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>v_CollectionRuleDirect</span><span class=p>.</span><span class=n>CollectionID</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>TOTAL</span><span class=w> </span><span class=k>DESC</span><span class=w>
</span></span></span></code></pre></div><p>However, with a little more nudging around we can add in the collections name to make it easier to find.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln>0</span><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>V_CollectionRuleDirect</span><span class=p>.</span><span class=n>CollectionID</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s1>&#39;CollectionID&#39;</span><span class=w>
</span></span></span><span class=line><span class=ln>1</span><span class=cl><span class=w>	</span><span class=p>,</span><span class=w> </span><span class=n>V_Collections</span><span class=p>.</span><span class=n>CollectionName</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s1>&#39;Collection Name&#39;</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>	</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=w> </span><span class=p>(</span><span class=n>V_CollectionRuleDirect</span><span class=p>.</span><span class=n>CollectionID</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s1>&#39;TOTAL&#39;</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>v_CollectionRuleDirect</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w></span><span class=k>LEFT</span><span class=w> </span><span class=k>OUTER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>v_Collections</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>V_Collections</span><span class=p>.</span><span class=n>SiteID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v_CollectionRuleDirect</span><span class=p>.</span><span class=n>CollectionID</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>v_CollectionRuleDirect</span><span class=p>.</span><span class=n>ResourceType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;5&#39;</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>v_CollectionRuleDirect</span><span class=p>.</span><span class=n>CollectionID</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>V_Collections</span><span class=p>.</span><span class=n>CollectionName</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>TOTAL</span><span class=w> </span><span class=k>DESC</span><span class=w>
</span></span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-08-17</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=http://jordantheitguy.com/posts/find-direct-membership-collections/ data-title="Find Direct Membership Collections" data-via=@JordanTheITGuy data-hashtags=SQL,ConfigMgr><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://jordantheitguy.com/posts/find-direct-membership-collections/ data-hashtag=SQL><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=http://jordantheitguy.com/posts/find-direct-membership-collections/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=http://jordantheitguy.com/posts/find-direct-membership-collections/ data-title="Find Direct Membership Collections" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=http://jordantheitguy.com/posts/find-direct-membership-collections/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/sql/>SQL</a>,&nbsp;<a href=/tags/configmgr/>ConfigMgr</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/memcm-community-hub-getting-started/ class=prev rel=prev title="MEMCM   Community Hub Getting Started"><i class="fas fa-angle-left fa-fw"></i>MEMCM Community Hub Getting Started</a>
<a href=/posts/mr-shiba-what-time-is-it-get-time-remotely/ class=next rel=next title="Mr Shiba What Time Is It - Get Time Remotely">Mr Shiba What Time Is It - Get Time Remotely<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by ‚òï and üçú</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">Jordan Benzing</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:15},comment:{utterances:{darkTheme:"github-dark",issueTerm:"title",label:"",lightTheme:"github-light",repo:"JordanTheITGuy/jordantheitguy.com-comments"}},data:{"id-1":"JordanTheITGuy","id-2":"JordanTheITGuy"},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"},typeit:{cursorChar:'\u003cspan style="color: #BD93F9" \u003e|\u003c/span\u003e',cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:75}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-FGZGWGHKYG')</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-FGZGWGHKYG" async></script></body></html>